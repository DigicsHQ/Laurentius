<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://java.sun.com/jsf/composite"
      >
    <composite:interface>
    </composite:interface>
    <composite:implementation >

        <p:confirmDialog widgetVar="DlgDeleteCert" id="deleteDialog" 
                         header="#{adminSEDKeyStores.dlgTitle}" 
                         message="#{adminSEDKeyStores.dlgMessage}"
                         width="400" showEffect="bounce"  closable="false" severity="alert" 
                         appendTo="@(body)" >
            <h:panelGroup layout="block" style="text-align: right">
                <p:commandButton value="Yes" rendered="#{adminSEDKeyStores.yesNoOption}" 
                                 action="#{adminSEDKeyStores.removeSelectedKey(adminSEDKeyStores.selectedCertificate)}" 
                                 oncomplete="PF('DlgDeleteCert').hide();" 
                                 update="keylist" />
                <p:commandButton value="No"  oncomplete="PF('DlgDeleteCert').hide();" />
            </h:panelGroup>
        </p:confirmDialog>
       
        <p:confirmDialog widgetVar="DlgAlert" id="DialogAlert" 
                         header="Delete" 
                         message="Delete this #{adminSEDKeyStores.selectedCertificate.alias}?"
                         width="400" showEffect="bounce"  closable="false" severity="alert" 
                         appendTo="@(body)" >
            <h:panelGroup layout="block" style="text-align: right">
                <p:commandButton value="Yes" action="#{adminSEDKeyStores.removeSelectedKey(adminSEDKeyStores.selectedCertificate)}" oncomplete="PF('DlgDeleteCert').hide();" update="keylist" />
                <p:commandButton value="No"  oncomplete="PF('DlgDeleteCert').hide();" />
            </h:panelGroup>
        </p:confirmDialog>


        <p:layout  id="CertTabView"  widgetVar="adminKeystoredView" style="min-width:400px;min-height:400px;height: 100%;width: 100%"  >

            <p:layoutUnit  position="north" resizable="true" closable="true" collapsible="true"
                           size="60" minSize="60" style="padding: 0px; margin: 0px"
                           gutter="0">
                <h1><h:outputLink id="CertificateUtils" value="#">
                        <span class="ui-icon-panel-Header ui-icon ui-icon-svg-certificate"  />#{msg['CertificateUtils']}
                    </h:outputLink>
                </h1>

                <p:selectOneButton value="#{adminSEDKeyStores.selectedTab}"            
                                   >
                    <f:selectItem itemLabel="Certificates" itemValue="Keystore" />
                    <f:selectItem itemLabel="RootCA" itemValue="RootCA" />
                    <f:selectItem itemLabel="CRL" itemValue="CRL" />
                    <p:ajax update="forms:SettingsCertPanel:CertTabView" event="change" listener="#{adminSEDKeyStores.tabChangeListener()}"/>
                </p:selectOneButton>
            </p:layoutUnit>
            <p:layoutUnit id="certTab" position="center" resizable="true" closable="true" collapsible="true"
                          size="400" minSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                          gutter="0"
                          rendered="#{adminSEDKeyStores.selectedTab.equalsIgnoreCase('Keystore')}"
                          >

                <p:scrollPanel mode="native" style="width:100%;height:100%"> 
                    <p:dataTable id="keylist" 
                                 value="#{adminSEDKeyStores.keystore.SEDCertificates}" 
                                 var="crt" 
                                 selectionMode="single"
                                 selection="#{adminSEDKeyStores.selectedCertificate}"                                     
                                 rowKey="#{crt.alias}"
                                 style="width:100%"
                                 scrollHeight="100%"
                                 scrollable="true"
                                 rowStyleClass="#{adminSEDKeyStores.isCertInvalid(crt) ? 'ui-datatable-cell-red': null}"
                                 >
                        <f:facet name="header">
                            <p:panelGrid >
                                <p:row>
                                    <p:column>Za uvoz certifikatov izberite datoteko:</p:column>
                                    <p:column><p:fileUpload fileUploadListener="#{adminSEDKeyStores.handleKeystoreUpload}"
                                                            skinSimple="true" dragDropSupport="true"
                                                            uploadLabel="#{msg['Add']}" 
                                                            cancelLabel="#{msg['Cancel']}" 
                                                            label="#{msg['Browse']}" 
                                                            multiple="false"
                                                            mode="advanced"
                                                            sizeLimit="1000000" 
                                                            update=":dlgcertificate:certDialogForm:certData"
                                                            auto="true"
                                                            /> 
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">
                                        <p:commandButton value="#{msg['Delete']}" styleClass="toolbar-Button"                                                          
                                                         update="keylist"
                                                         icon="ui-icon-svg-remove ui-icon-size-22"  
                                                         actionListener="#{adminSEDKeyStores.deleteSelectedCertificate()}"                                                         
                                                         >

                                        </p:commandButton>
                                        <p:commandButton value="#{msg['Edit']}" styleClass="toolbar-Button"                                                          
                                                         update="keylist"
                                                         icon="ui-icon-svg-edit ui-icon-size-22"  
                                                         actionListener="#{adminSEDKeyStores.renameSelectedCertificateAlias()}"                                                         
                                                         >

                                        </p:commandButton>

                                    </p:column>
                                </p:row>
                            </p:panelGrid>



                        </f:facet>


                        <p:columnGroup type="header">
                            <p:row>
                                <p:column rowspan="2" headerText="#{msg['IsKey']}" width="40"/>
                                <p:column rowspan="2" headerText="#{msg['Alias']}" width="100" />
                                <p:column rowspan="2" headerText="#{msg['IssuerDN']}" />
                                <p:column rowspan="2" headerText="#{msg['SubjectDN']}" />
                                <p:column colspan="2" headerText="#{msg['Valid']}" width="120" />

                            </p:row>
                            <p:row>
                                <p:column headerText="#{msg['from']}" width="70" />
                                <p:column headerText="#{msg['to']}" width="70" />
                            </p:row>

                        </p:columnGroup>

                        <p:column >
                            <h:graphicImage rendered="#{crt.keyEntry}" value="#{resource['images:/privateKeyLong.svg']}" width="40" height="18" />
                            <h:graphicImage rendered="#{not crt.keyEntry}" value="#{resource['images:/certificateLong.svg']}" width="40" height="18" />
                        </p:column>     
                        <p:column width="120">
                            <h:outputText value="#{crt.alias}" />
                        </p:column>     
                        <p:column>
                            <h:outputText value="#{crt.issuerDN}" />
                        </p:column>     
                        <p:column>
                            <h:outputText value="#{crt.subjectDN}" />
                        </p:column>     
                        <p:column >
                            <h:outputText value="#{crt.validFrom}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     
                        <p:column >
                            <h:outputText value="#{crt.validTo}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     




                    </p:dataTable>
                </p:scrollPanel>



            </p:layoutUnit>
            <p:layoutUnit  position="center" resizable="true" closable="true" collapsible="true"
                           size="400" minSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                           gutter="0"
                           rendered="#{adminSEDKeyStores.selectedTab.equalsIgnoreCase('RootCA')}"
                           >         

                <p:scrollPanel mode="native" style="width:100%;height:100%"> 
                    <p:dataTable id="RootCAlist" 
                                 value="#{adminSEDKeyStores.rootCAStore.SEDCertificates}" 
                                 var="crt" 
                                 selectionMode="single"
                                 selection="#{adminSEDKeyStores.selectedRootCA}"                                     
                                 rowKey="#{crt.alias}"
                                 style="width:100%"
                                 scrollHeight="100%"
                                 scrollable="true"
                                 rowStyleClass="#{adminSEDKeyStores.isCertInvalid(crt) ? 'ui-datatable-cell-red': null}"
                                 >
                        <f:facet name="header">
                            <p:panelGrid >
                                <p:row>
                                    <p:column>Za uvoz korenskih certifikatov izberite datoteko:</p:column>
                                    <p:column><p:fileUpload fileUploadListener="#{adminSEDKeyStores.handleKeystoreUpload}"
                                                            skinSimple="true" dragDropSupport="true"
                                                            uploadLabel="#{msg['Add']}" 
                                                            cancelLabel="#{msg['Cancel']}" 
                                                            label="#{msg['Browse']}" 
                                                            multiple="false"
                                                            mode="advanced"
                                                            sizeLimit="1000000" 
                                                            update=":dlgcertificate:certDialogForm:certData"
                                                            auto="true"
                                                            /> 
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">
                                        <p:commandButton value="#{msg['Delete']}" styleClass="toolbar-Button" 
                                                         process="RootCAlist"
                                                         icon="ui-icon-svg-remove ui-icon-size-22"  
                                                         actionListener="#{adminSEDKeyStores.removeSelectedRootCA(adminSEDKeyStores.selectedRootCA)}"
                                                         update="RootCAlist"
                                                         />
                                    </p:column>
                                </p:row>
                            </p:panelGrid>



                        </f:facet>


                        <p:columnGroup type="header">
                            <p:row>
                                <p:column rowspan="2" headerText="#{msg['IsKey']}" width="40"/>
                                <p:column rowspan="2" headerText="#{msg['Alias']}" width="100" />
                                <p:column rowspan="2" headerText="#{msg['IssuerDN']}" />
                                <p:column rowspan="2" headerText="#{msg['SubjectDN']}" />
                                <p:column colspan="2" headerText="#{msg['Valid']}" width="120" />

                            </p:row>
                            <p:row>
                                <p:column headerText="#{msg['from']}" width="70" />
                                <p:column headerText="#{msg['to']}" width="70" />
                            </p:row>

                        </p:columnGroup>
                        <p:column >
                            <h:graphicImage rendered="#{crt.keyEntry}" value="#{resource['images:/privateKeyLong.svg']}" width="48" height="18" />
                            <h:graphicImage rendered="#{not crt.keyEntry}" value="#{resource['images:/certificateLong.svg']}" width="48" height="18" />

                        </p:column>     
                        <p:column width="120">
                            <h:outputText value="#{crt.alias}" />
                        </p:column>     
                        <p:column>
                            <h:outputText value="#{crt.issuerDN}" />
                        </p:column>     
                        <p:column>
                            <h:outputText value="#{crt.subjectDN}" />
                        </p:column>     
                        <p:column >
                            <h:outputText value="#{crt.validFrom}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     
                        <p:column >
                            <h:outputText value="#{crt.validTo}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     




                    </p:dataTable>
                </p:scrollPanel>

            </p:layoutUnit>
            <p:layoutUnit id="CRLTab"  position="center" resizable="true" closable="true" collapsible="true"
                          size="400" minSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                          gutter="0"
                          rendered="#{adminSEDKeyStores.selectedTab.equalsIgnoreCase('CRL')}"
                          >         
                <p:scrollPanel mode="native" style="width:100%;height:100%"> <!-- p:dataTable scrollable does not resize when toogled south panel -->                


                    <h:outputText value="#{msg['RootCA']}"></h:outputText>


                    <p:dataTable id="TblCRL" 
                                 var="sp" 
                                 value="#{adminSEDKeyStores.CRLList}"

                                 rowKey="#{sp.id}"
                                 currentPageReportTemplate="#{msg['Showing']} {startRecord}-{endRecord} #{msg['OutOf']} {totalRecords}"
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="25,50,100,200" 
                                 paginator="true" 
                                 style="padding: 0px; margin: 0px"
                                 scrollable="true" 
                                 scrollHeight="90%"
                                 rows="100"  >
                        <f:facet name="header">
                            <p:commandButton value="#{msg['Refresh']}"  styleClass="toolbar-Button" 
                                             icon="ui-icon-svg-refresh ui-icon-size-22"  
                                             actionListener="#{adminSEDKeyStores.refreshCRLList()}"
                                             update="TblCRL"  
                                             />

                        </f:facet>
                        <p:column headerText="#{msg['Id']}" width="60">
                            <h:outputText value="#{sp.id}" /></p:column>


                        <p:column headerText="#{msg['IssuerDN']}" >
                            <h:outputText value="#{sp.issuerDN}"></h:outputText>                
                        </p:column>
                        <p:column headerText="#{msg['Http']}" width="120">
                            <h:outputText value="#{sp.http}" ></h:outputText>                
                        </p:column>
                        <p:column headerText="#{msg['Ldap']}" width="120">
                            <h:outputText value="#{sp.ldap}" ></h:outputText>                
                        </p:column>

                        <p:column headerText="#{msg['effectiveDate']}" width="60">
                            <h:outputText value="#{sp.effectiveDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>                
                        </p:column>
                        <p:column headerText="#{msg['nextUpdateDate']}" width="60">
                            <h:outputText value="#{sp.nextUpdateDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>                
                        </p:column>
                        <p:column headerText="#{msg['retrievedDate']}" width="60">
                            <h:outputText value="#{sp.retrievedDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>
                        </p:column>
                        <p:column headerText="#{msg['filePath']}" width="80">
                            <h:outputText value="#{sp.filePath}" ></h:outputText>                
                        </p:column>

                    </p:dataTable>

                </p:scrollPanel>


            </p:layoutUnit>
        </p:layout>

    </composite:implementation>


</html>
