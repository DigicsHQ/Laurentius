<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://java.sun.com/jsf/composite"
      >
    <composite:interface>
    </composite:interface>


    <composite:implementation >
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="#{msg['Ok']}"
                             type="button" 
                             styleClass="ui-confirmdialog-yes"
                             icon="ui-icon-svg-ok ui-icon-size-22"  />
            <p:commandButton value="#{msg['Cancel']}" type="button" 
                             styleClass="ui-confirmdialog-no"
                             icon="ui-icon-svg-cancel ui-icon-size-22"  />
        </p:confirmDialog>

        <p:layout   widgetVar="adminKeystoredView" style="min-width:400px;min-height:400px;height: 100%;width: 100%"  >
            <p:layoutUnit  position="center" resizable="true" closable="true" collapsible="true"
                           size="400" minSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                           gutter="0">
                <h1><h:outputLink id="CertificateUtils" value="#">
                        <span class="ui-icon-panel-Header ui-icon ui-icon-svg-certificate"  />#{msg['CertificateUtils']}
                    </h:outputLink>
                </h1>
                <p:tabView id="CertTabView" style="height: 100%" >
                    <p:tab id="CertKeyStoreTab" >
                        <f:facet name="title">
                            <h:graphicImage value="#{resource['images:/privateCertifikate.svg']}" width="32" height="32" />
                            <h:outputText value="#{msg['CertKeyStore']}" />
                        </f:facet>
                        <p:panelGrid  style="width:100%;">
                            <p:row>
                                <p:column colspan="2">
                                    <h:outputText  style="font-weight: bold" value="#{msg['ImportFromKeystore']}:"  />
                                </p:column>
                                <p:column colspan="2">
                                    <h:outputText style="font-weight: bold" value="#{msg['Keystore']}:"  />
                                </p:column>
                            </p:row>
                            <p:row >
                                <p:column colspan="2" rowspan="5">
                                    <p:fileUpload fileUploadListener="#{adminSEDKeyStores.handleKeystoreUpload}"
                                                  skinSimple="true" dragDropSupport="true"
                                                  uploadLabel="#{msg['Add']}" 
                                                  cancelLabel="#{msg['Cancel']}" 
                                                  label="#{msg['Key']}" 
                                                  multiple="false"
                                                  mode="advanced"
                                                  sizeLimit="1000000" 
                                                  update=":dlgcertificate:certDialogForm:certData"
                                                  auto="true"
                                                  allowTypes="/(\.|\/)(jks|p12|pfx)$/"                                       

                                                  style="height: 120px"/> 

                                </p:column>

                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg['Name']}:"  />
                                </p:column>
                                <p:column>
                                    <p:inputText id="keystoreName" value="#{adminSEDKeyStores.keystore.name}"  style="width: 300px" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>                                    
                                    <h:outputText value="#{msg['FilePath']}:"  />
                                </p:column>
                                <p:column>
                                    <p:inputText id="keystoreFile" value="#{adminSEDKeyStores.keystore.filePath}"  style="width: 300px" />                                                       
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg['Type']}:" />
                                </p:column>
                                <p:column>
                                    <p:selectOneMenu value="#{adminSEDKeyStores.keystore.type}"  style="width: 300px !important" >
                                        <f:selectItem itemLabel="JKS" itemValue="JKS" />
                                        <f:selectItem itemLabel="PKCS12" itemValue="PKCS12" />
                                    </p:selectOneMenu>  
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg['Password']}:" />
                                </p:column>
                                <p:column>
                                    <p:inputText  value="#{adminSEDKeyStores.keystore.password}" />
                                </p:column>
                            </p:row>

                        </p:panelGrid>

                        <p:dataTable id="keylist" 
                                     value="#{adminSEDKeyStores.keystore.SEDCertificates}" 
                                     var="crt" 
                                     selectionMode="single"
                                     selection="#{adminSEDKeyStores.selectedKeyCertificate}"                                     
                                     rowKey="#{crt.alias}"
                                     style="width:100%"
                                     scrollHeight="200"
                                     scrollable="true"
                                     rowStyleClass="#{adminSEDKeyStores.isCertInvalid(crt) ? 'ui-datatable-cell-red': null}"
                                     >
                            <f:facet name="header">


                                <p:commandButton value="#{msg['Delete']}" styleClass="toolbar-Button" 
                                                 process="keylist"
                                                 icon="ui-icon-svg-remove ui-icon-size-22"  
                                                 actionListener="#{adminSEDKeyStores.removeSelectedKey(adminSEDKeyStores.selectedKeyCertificate)}"
                                                 update="keylist"
                                                 >

                                </p:commandButton>



                            </f:facet>


                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column rowspan="2" headerText="#{msg['IsKey']}" width="40"/>
                                    <p:column rowspan="2" headerText="#{msg['Alias']}" width="100" />
                                    <p:column rowspan="2" headerText="#{msg['IssuerDN']}" />
                                    <p:column rowspan="2" headerText="#{msg['SubjectDN']}" />
                                    <p:column colspan="2" headerText="#{msg['Valid']}" width="120" />

                                </p:row>
                                <p:row>
                                    <p:column headerText="#{msg['from']}" width="70" />
                                    <p:column headerText="#{msg['to']}" width="70" />
                                </p:row>

                            </p:columnGroup>
                            <p:column >
                                <h:graphicImage rendered="#{crt.keyEntry}" value="#{resource['images:/privateCertifikate.svg']}" width="18" height="18" />
                                <h:graphicImage rendered="#{not crt.keyEntry}" value="#{resource['images:/certificate.svg']}" width="18" height="18" />

                            </p:column>     
                            <p:column width="120">
                                <h:outputText value="#{crt.alias}" />
                            </p:column>     
                            <p:column>
                                <h:outputText value="#{crt.issuerDN}" />
                            </p:column>     
                            <p:column>
                                <h:outputText value="#{crt.subjectDN}" />
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.validFrom}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.validTo}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                            </p:column>     




                        </p:dataTable>
                    </p:tab>
                    <p:tab  id="CertTrustStoreTab">
                        <f:facet name="title">
                            <h:graphicImage value="#{resource['images:/certificate.svg']}" width="32" height="32"/>                            
                            <h:outputText value="#{msg['CertTrustStore']}" />
                        </f:facet>
                        <p:panelGrid  style="width:100%;">
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg['Name']}:"  />
                                </p:column>
                                <p:column>
                                    <p:inputText id="truststoreName" value="#{adminSEDKeyStores.truststore.name}"  style="width: 300px" />
                                </p:column>
                                <p:column>                                    
                                    <h:outputText value="#{msg['FilePath']}:"  />
                                </p:column>
                                <p:column>
                                    <p:inputText id="truststoreFile" value="#{adminSEDKeyStores.truststore.filePath}"  style="width: 300px" />                                                       
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <h:outputText value="#{msg['Type']}:" />
                                </p:column>
                                <p:column>
                                    <p:selectOneMenu value="#{adminSEDKeyStores.truststore.type}"  style="width: 300px !important" >
                                        <f:selectItem itemLabel="JKS" itemValue="JKS" />
                                        <f:selectItem itemLabel="PKCS12" itemValue="PKCS12" />
                                    </p:selectOneMenu>  
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{msg['Password']}:" />
                                </p:column>
                                <p:column>
                                    <p:inputText  value="#{adminSEDKeyStores.truststore.password}" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:commandButton value="#{msg['RefreshFromKS']}" 

                                                     />
                                </p:column>
                                <p:column>
                                    <h:outputText value="" />
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:dataTable id="trustCertlist" 
                                     value="#{adminSEDKeyStores.truststore.SEDCertificates}" 
                                     var="crt" 
                                     selectionMode="single"
                                     selection="#{adminSEDKeyStores.selectedTrustCertificate}"
                                     rowKey="#{crt.alias}"                                     
                                     style="width:100%"
                                     scrollHeight="200"
                                     scrollable="true"
                                     rowStyleClass="#{adminSEDKeyStores.isCertInvalid(crt) ? 'ui-datatable-cell-red': null}"
                                     >
                            <p:columnGroup type="header">
                                <p:row>
                                    <p:column rowspan="2" headerText="#{msg['Alias']}" width="100" />
                                    <p:column rowspan="2" headerText="#{msg['IssuerDN']}" />
                                    <p:column rowspan="2" headerText="#{msg['SubjectDN']}" />
                                    <p:column colspan="2" headerText="#{msg['Valid']}" width="120" />
                                    <p:column rowspan="2" headerText="#{msg['IsKey']}" width="40"/>
                                    <p:column rowspan="2" headerText="#{msg['Status']}" width="50" />

                                </p:row>
                                <p:row>
                                    <p:column headerText="#{msg['from']}" width="70" />
                                    <p:column headerText="#{msg['to']}" width="70" />
                                </p:row>

                            </p:columnGroup>

                            <p:column width="120">
                                <h:outputText value="#{crt.alias}" />
                            </p:column>     
                            <p:column>
                                <h:outputText value="#{crt.issuerDN}" />
                            </p:column>     
                            <p:column>
                                <h:outputText value="#{crt.subjectDN}" />
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.validFrom}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.validTo}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.keyEntry}"/>
                            </p:column>     
                            <p:column >
                                <h:outputText value="#{crt.status}" />                        
                            </p:column> 



                        </p:dataTable>
                    </p:tab>

                    <p:tab id="CertCRLTab">
                        <f:facet name="title">
                            <h:graphicImage value="#{resource['images:/crl.svg']}" width="32" height="32"/>                            
                            <h:outputText value="#{msg['CertCRL']}" />
                        </f:facet>



                        <p:scrollPanel mode="native" style="width:100%;height:100%"> <!-- p:dataTable scrollable does not resize when toogled south panel -->                


                            <h:outputText value="#{msg['RootCA']}"></h:outputText>


                            <p:dataTable id="TblCRL" 
                                         var="sp" 
                                         value="#{adminSEDKeyStores.CRLList}"

                                         rowKey="#{sp.id}"
                                         currentPageReportTemplate="#{msg['Showing']} {startRecord}-{endRecord} #{msg['OutOf']} {totalRecords}"
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="25,50,100,200" 
                                         paginator="true" 
                                         style="padding: 0px; margin: 0px"
                                         scrollable="true" 
                                         scrollHeight="90%"
                                         rows="100"  >
                                <f:facet name="header">
                                    <p:commandButton value="#{msg['Refresh']}"  styleClass="toolbar-Button" 
                                                     icon="ui-icon-svg-refresh ui-icon-size-22"  
                                                     actionListener="#{adminSEDKeyStores.refreshCRLList()}"
                                                      update="TblCRL"  
                                                     />

                                </f:facet>
                                <p:column headerText="#{msg['Id']}" width="60">
                                    <h:outputText value="#{sp.id}" /></p:column>


                                <p:column headerText="#{msg['IssuerDN']}" >
                                    <h:outputText value="#{sp.issuerDN}"></h:outputText>                
                                </p:column>
                                <p:column headerText="#{msg['Http']}" width="120">
                                    <h:outputText value="#{sp.http}" ></h:outputText>                
                                </p:column>
                                <p:column headerText="#{msg['Ldap']}" width="120">
                                    <h:outputText value="#{sp.ldap}" ></h:outputText>                
                                </p:column>

                                <p:column headerText="#{msg['effectiveDate']}" width="60">
                                    <h:outputText value="#{sp.effectiveDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>                
                                </p:column>
                                <p:column headerText="#{msg['nextUpdateDate']}" width="60">
                                    <h:outputText value="#{sp.nextUpdateDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>                
                                </p:column>
                                <p:column headerText="#{msg['retrievedDate']}" width="60">
                                    <h:outputText value="#{sp.retrievedDate}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="CET" /></h:outputText>
                                </p:column>
                                <p:column headerText="#{msg['filePath']}" width="80">
                                    <h:outputText value="#{sp.filePath}" ></h:outputText>                
                                </p:column>

                            </p:dataTable>

                        </p:scrollPanel>
                    </p:tab>
                </p:tabView>



            </p:layoutUnit>      
        </p:layout>
    </composite:implementation>


</html>
