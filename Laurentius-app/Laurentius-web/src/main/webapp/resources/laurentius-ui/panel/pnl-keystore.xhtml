<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://java.sun.com/jsf/composite"
      >
    <composite:interface>
    </composite:interface>
    <composite:implementation >



        <p:layout  id="CertTabView"  widgetVar="adminKeystoredView" style="min-width:400px;min-height:400px;height: 100%;width: 100%"  >
            <p:layoutUnit  position="north" resizable="true" closable="true" collapsible="true"
                           size="38" minSize="38" maxSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                           gutter="0">
                <h1><h:outputLink id="growPanelDesc" value="#">
                        <span class="ui-icon-panel-Header ui-icon ui-icon-svg-key"  />#{msg['Keystore']}
                    </h:outputLink>
                </h1>
                <p:tooltip id="toolTipGrow" for="growPanelDesc" position="bottom">
                    <h:outputText value="#{msg['KeyStoreDefDesc']}"></h:outputText>
                </p:tooltip>                
            </p:layoutUnit>


            <p:layoutUnit id="certTab" position="center" resizable="true" closable="true" collapsible="true"
                          size="400" minSize="400" style="width:100%;height:100%;padding: 0px; margin: 0px"
                          gutter="0"
                          >

                <p:scrollPanel mode="native" style="width:100%;height:100%"> 
                    <p:dataTable id="keylist" 
                                 value="#{adminSEDKeystoreView.list}" 
                                 var="crt" 
                                 selectionMode="single"
                                 selection="#{adminSEDKeystoreView.selected}"
                                 rowKey="#{crt.alias}"
                                 style="width:100%"
                                 scrollHeight="100%"
                                 scrollable="true"
                                 rowStyleClass="#{adminSEDKeystoreView.getRowClass(crt)}"
                                 >
                        <f:facet name="header">
                            <p:toolbar  id="toolbar" style="padding: 0; margin: 0; height: 30px; vertical-align: middle;">
                                <f:facet name="left"  >
                                    <p:commandButton value="#{msg['AddCertKey']}" styleClass="toolbar-Button"         
                                                     icon="ui-icon-svg-add ui-icon-size-22"                                                    
                                                     oncomplete="PF('certImportDialog').show()"
                                                     action="#{dialogImportCert.setDialogType('DLG_CERTSTORE')}" 
                                                     update=":dlgcertimport:certImportDialogForm"
                                                     />

                                    <p:commandButton value="#{msg['Edit']}" styleClass="toolbar-Button"         
                                                     icon="ui-icon-svg-edit ui-icon-size-22"                                                    
                                                     actionListener="#{adminSEDKeystoreView.startEditSelected()}" 
                                                     oncomplete="PF('certDialog').show()"
                                                     update=":dlgcertificate:certDialogForm:certData"
                                                     />
                                    <p:commandButton value="#{msg['Delete']}" styleClass="toolbar-Button"                                                          
                                                     update="keylist"
                                                     icon="ui-icon-svg-remove ui-icon-size-22"  
                                                     actionListener="#{adminSEDKeystoreView.removeSelectedWithWarning()}" 
                                                     />
                                </f:facet>
                                <f:facet name="right"  >
                                    <p:menuButton value="#{msg['Settings']}" 

                                                  >

                                        <p:menuitem value="#{msg['Password']}" 
                                                    ajax="true"
                                                    onclick="PF('changeCertStorePasswordDialog').show();"/>
                                    </p:menuButton >

                                </f:facet>
                            </p:toolbar>
                        </f:facet>

                        <p:ajax event="rowDblselect" 
                                listener="#{adminSEDKeystoreView.startEditSelected()}" 
                                oncomplete="PF('certDialog').show()"
                                update=":dlgcertificate:certDialogForm:certData" />
                        <p:columnGroup type="header">
                            <p:row>
                                <p:column rowspan="2" headerText="#{msg['IsKey']}" width="40"/>
                                <p:column rowspan="2" headerText="#{msg['Alias']}" width="100" />
                                <p:column colspan="2" headerText="#{msg['Valid']}" width="120" />
                                <p:column rowspan="2" headerText="#{msg['IssuerDN']}" />
                                <p:column rowspan="2" headerText="#{msg['SubjectDN']}" />


                            </p:row>
                            <p:row>
                                <p:column headerText="#{msg['from']}" width="70" />
                                <p:column headerText="#{msg['to']}" width="70" />
                            </p:row>

                        </p:columnGroup>

                        <p:column >
                            <h:graphicImage rendered="#{crt.keyEntry}" value="#{resource['images:/privateKeyLong.svg']}" width="40" height="18" />
                            <h:graphicImage rendered="#{not crt.keyEntry}" value="#{resource['images:/certificateLong.svg']}" width="40" height="18" />
                        </p:column>     
                        <p:column width="120">
                            <h:outputText value="#{crt.alias}" />
                        </p:column>  
                        <p:column >
                            <h:outputText value="#{crt.validFrom}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     
                        <p:column >
                            <h:outputText value="#{crt.validTo}"  ><f:convertDateTime pattern="dd.MM.yyyy" timeZone="CET" /></h:outputText>
                        </p:column>     

                        <p:column>
                            <h:outputText value="#{crt.issuerDN}" />
                        </p:column>     
                        <p:column>
                            <h:outputText value="#{crt.subjectDN}" />
                        </p:column>     
                    </p:dataTable>
                </p:scrollPanel>
            </p:layoutUnit>
        </p:layout>

        <!-- p:dialog widgetVar="changeCertStorePasswordDialog"
                  modal="true" closeOnEscape="true" header="#{msg['ResetKeystorePassword']}" 
                  appendTo="@(body)" width="350"  height="160">
            <p:layout id="dlgKeystorePassword" style="min-width:300px;height:150px;">
                <p:layoutUnit position="center"  >
                    <p:outputPanel id="changePasswordPanel">
                        <p:messages showDetail="true"/><br/>
                        <h:panelGrid columnClasses="view-label-column,view-data-column" width="100%" columns="2">
                            <h:panelGrid columns="2" id="matchGrid" cellpadding="5">                   
                                <h:outputLabel for="pwd1" value="#{msg['Password']}: *" />
                                <p:password id="pwd1" value="# {adminSEDKeystoreView.password}" match="pwd2" label="Password 1" required="true" />

                                <h:outputLabel for="pwd2" value="#{msg['RepeatPassword']}: *" />
                                <p:password id="pwd2" value="# {adminSEDKeystoreView.password}" label="Password 2" required="true" />
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:outputPanel>
                </p:layoutUnit>
                <p:layoutUnit position="south"  size="40" minSize="40" maxSize="40" >
                    <p:toolbar 
                        styleClass="dialogButtonBar" >
                        <f:facet name="right"  >
                            <p:commandButton value="#{msg['Ok']}"  
                                             process="changePasswordPanel"
                                             styleClass="toolbar-Button" 
                                             icon="ui-icon-svg-ok ui-icon-size-22" 
                                             actionListener="# {adminSEDKeystoreView.resetPassword()}"
                                             ajax="true"
                                             oncomplete="if (args ==null  or !args.failed) PF('changeCertStorePasswordDialog').hide()" 
                                             update="forms:PanelKeystore:dlgKeystorePassword"
                                             />
                            <p:commandButton value="#{msg['Cancel']}"
                                             styleClass="toolbar-Button"
                                             icon="ui-icon-svg-cancel ui-icon-size-22" 
                                             onclick="PF('changeCertStorePasswordDialog').hide();return false;"/>                                                 
                        </f:facet>
                    </p:toolbar>
                </p:layoutUnit>
            </p:layout>
        </p:dialog -->

    </composite:implementation>


</html>
